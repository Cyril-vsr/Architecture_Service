<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room and Window Management</title>
    <style>
        .room { border: 2px solid blue; margin: 10px; padding: 10px; border-radius: 10px; }
        .window { border: 2px solid green; margin: 5px; padding: 5px; display: inline-block; border-radius: 5px; }
        .association { border: 2px dashed orange; margin: 10px; padding: 10px; }
        .navigation { margin: 20px; }
        .navigation button { padding: 10px 20px; font-size: 16px; }
    </style>
</head>
<body onload="initialize()">

    <div class="navigation">
        <button onclick="navigateToHistory()">Go to History</button>
    </div>

    <h1>Room and Window Management</h1>

    <!-- Add Room -->
    <div>
        <h2>Add a Room</h2>
        <form onsubmit="addRoom(event)">
            <input type="text" id="room-name" placeholder="Room Name" required>
            <button type="submit">Add Room</button>
        </form>
    </div>

    <!-- Add Window -->
    <div>
        <h2>Add a Window</h2>
        <form onsubmit="addWindow(event)">
            <input type="text" id="window-name" placeholder="Window Name" required>
            <select id="room-select-for-window" required>
                <option value="">Select Room</option>
                <!-- Options will be populated dynamically -->
            </select>
            <button type="submit">Add Window</button>
        </form>
    </div>

    <!-- Add Sensor -->
    <div>
        <h2>Add a Sensor</h2>
        <form onsubmit="addSensor(event)">
            <input type="text" id="sensor-name" placeholder="Sensor Name" required>
            <input type="number" id="sensor-value" placeholder="Initial Value" required>
            <input type="text" id="sensor-position" placeholder="Position" required>
            <button type="submit">Add Sensor</button>
        </form>
    </div>

    <!-- Associate Windows to Rooms -->
    <div>
        <h2>Associate Windows to Rooms</h2>
        <form onsubmit="associateWindowToRoom(event)">
            <select id="room-select" required>
                <option value="">Select Room</option>
                <!-- Options will be populated dynamically -->
            </select>
            <select id="window-select" required>
                <option value="">Select Window</option>
                <!-- Options will be populated dynamically -->
            </select>
            <button type="submit">Associate</button>
        </form>
    </div>

    <!-- Associate Sensors to Rooms -->
    <div>
        <h2>Associate Sensors to Rooms</h2>
        <form onsubmit="associateSensorToRoom(event)">
            <select id="room-select-for-sensor" required>
                <option value="">Select Room</option>
                <!-- Options will be populated dynamically -->
            </select>
            <select id="sensor-select" required>
                <option value="">Select Sensor</option>
                <!-- Options will be populated dynamically -->
            </select>
            <button type="submit">Associate</button>
        </form>
    </div>

    <!-- Lists -->
    <h2>Rooms</h2>
    <div id="room-list"></div>

    <h2>Windows</h2>
    <div id="window-list"></div>

    <h2>Sensors</h2>
    <div id="sensor-list"></div>
    <select id="sensor-select"></select>


    <h2>Room-Window Associations</h2>
    <div id="associations"></div>

    <script>
        const ROOM_URL = "http://localhost:8083/rooms";
        const WINDOW_URL = "http://localhost:8082/windows";
        const SENSOR_URL = "http://localhost:8081/sensors";
        const ASSOCIATION_URL = "http://localhost:8080/associations";

        function initialize() {
            fetchAllRooms();
            fetchAllWindows();
            fetchAllSensors();
        }

        function fetchAllRooms() {
            fetch(ROOM_URL)
                .then(response => response.json())
                .then(rooms => {
                    const roomSelectForWindow = document.getElementById("room-select-for-window");
                    const roomSelectForSensor = document.getElementById("room-select-for-sensor");
                    const roomSelect = document.getElementById("room-select");
                    roomSelectForWindow.innerHTML = '<option value="">Select Room</option>';
                    roomSelectForSensor.innerHTML = '<option value="">Select Room</option>';
                    roomSelect.innerHTML = '<option value="">Select Room</option>';
                    rooms.forEach(room => {
                        const option = document.createElement("option");
                        option.value = room.id;
                        option.textContent = room.name;
                        roomSelectForWindow.appendChild(option);
                        roomSelectForSensor.appendChild(option.cloneNode(true));
                        roomSelect.appendChild(option.cloneNode(true));
                    });
                })
                .catch(console.error);
        }

        function fetchAllWindows() {
            fetch(WINDOW_URL)
                .then(response => response.json())
                .then(windows => {
                    const windowSelectForSensor = document.getElementById("window-select-for-sensor");
                    const windowSelect = document.getElementById("window-select");
                    windowSelectForSensor.innerHTML = '<option value="">Select Window</option>';
                    windowSelect.innerHTML = '<option value="">Select Window</option>';
                    windows.forEach(window => {
                        const option = document.createElement("option");
                        option.value = window.id;
                        option.textContent = window.name;
                        windowSelectForSensor.appendChild(option);
                        windowSelect.appendChild(option.cloneNode(true));
                    });
                })
                .catch(console.error);
        }

        function fetchAllSensors() {
            fetch(SENSOR_URL)
                .then(response => response.json())
                .then(sensors => {
                    const sensorSelect = document.getElementById("sensor-select");
                    sensorSelect.innerHTML = '<option value="">Select Sensor</option>';
                    sensors.forEach(sensor => {
                        const option = document.createElement("option");
                        option.value = sensor.id;
                        option.textContent = sensor.name;
                        sensorSelect.appendChild(option);
                    });
                })
                .catch(console.error);
        }

        function addRoom(event) {
            event.preventDefault();
            const roomName = document.getElementById("room-name").value;

            fetch(ROOM_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name: roomName })
            })
                .then(fetchAllRooms)
                .catch(console.error);
        }

        function addWindow(event) {
            event.preventDefault();
            const windowName = document.getElementById("window-name").value;
            const roomId = document.getElementById("room-select-for-window").value;

            fetch(WINDOW_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name: windowName, roomId: roomId })
            })
                .then(fetchAllWindows)
                .catch(console.error);
        }

        function addSensor(event) {
            event.preventDefault();
            const sensorName = document.getElementById("sensor-name").value;
            const sensorValue = document.getElementById("sensor-value").value;
            const sensorPosition = document.getElementById("sensor-position").value;
            const windowId = document.getElementById("window-select-for-sensor").value;

            fetch(SENSOR_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name: sensorName, value: sensorValue, position: sensorPosition, windowId: windowId })
            })
                .then(fetchAllSensors)
                .catch(console.error);
        }

        function associateWindowToRoom(event) {
            event.preventDefault();
            const roomId = document.getElementById("room-select").value;
            const windowId = document.getElementById("window-select").value;

            if (!roomId || !windowId) {
                alert("Please select a room and a window.");
                return;
            }

            fetch(`${ASSOCIATION_URL}/windows`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ roomId, windowId })
            })
                .then(fetchAllAssociations)
                .catch(console.error);
        }

        function associateSensorToRoom(event) {
            event.preventDefault();
            const roomId = document.getElementById("room-select-for-sensor").value;
            const sensorId = document.getElementById("sensor-select").value;

            if (!roomId || !sensorId) {
                alert("Please select a room and a sensor.");
                return;
            }

            fetch(`${ASSOCIATION_URL}/sensors`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ roomId, sensorId })
            })
                .then(fetchAllAssociations)
                .catch(console.error);
        }

        function navigateToHistory() {
            window.location.href = "historic";
        }

        function fetchAllAssociations() {
            fetch(ASSOCIATION_URL)
                .then(response => response.json())
                .then(data => {
                    const associationList = document.getElementById("associations");
                    associationList.innerHTML = "";
                    data.forEach(assoc => {
                        const windows = assoc.windows.map(w => `<div>Window: ${w.name}</div>`).join("");
                        const sensors = assoc.sensors.map(s => `<div>Sensor Position: ${s.position}</div>`).join("");
                        associationList.innerHTML += `
                            <div class="association">
                                <h3>Room: ${assoc.room.name}</h3>
                                <div>Windows: ${windows}</div>
                                <div>Sensors: ${sensors}</div>
                            </div>
                        `;
                    });
                })
                .catch(console.error);
        }
    </script>
</body>
</html>
